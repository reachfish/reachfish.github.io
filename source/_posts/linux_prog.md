---
title: Linux编程学习
---

## 知识点

### 文件描述符

* open

open 返回的是一个文件描述符。文件描述符起到的是一个索引的作用，进程通过PCB中的文件描述符表找到该fd所指向的文件指针。

* fopen

流(如fopen) 返回的则是一个FILE结构指针，FILE结构包含有文件描述符fd，FILE结构是对fd直接操作的系统调用的封装，优点是带有IO缓存。

### 常用命令

* netstat

输出分为:1)Active Internet connections:有源TCP连接。2)Active UNIX domain sockets，称为有源Unix域套接口(和网络套接字一样，但是只能用于本机通信，性能可以提高一倍)。

* tcpdump

截获通过本机网络接口的数据，用以分析。

* ipcs(ipc show)

ipcs：检查系统上共享内存、消息队列、信号量的分配。

### 进程  

进程的状态：
* 可运行：正在运行或者准备运行
* 等待：等待某个事件或等待资源
* 暂停：一般是收到某些信号，如SIGSTOP
* 僵死状态：进程已经结束，但父进程没有执行wait系统调用

进程间的通信有：基于Unix的IPC，如信号，管道Pipe；和基于System V/Posix中的信号量，消息队列和共享内存。

子进程的task_struct中的很多地方都是拷贝父进程的task_struct。

除了内核进程，每个进程都有自己的虚拟空间，用mm来记录。

### 进程间的通信 IPC

进程间的通信包含同步和互斥两种概念。同步是指进程间相互协调，按顺序处理任务，如生产者-消费者问题。互斥则是指某个资源一次只能被一个进程访问。

* 互斥

临界资源：只能被一个进程独占的资源，如打印机，硬盘或内存中被多个进程中的共享数据。
临界区：访问临界资源的代码。

实现临界资源的访问：
1.硬件方式。因为需要中断才能进行切换，所以可以使用关中断的方式避免进程间的切换，让一个进程执行完临界区代码后再开中断。
2.软件方式。使用信号量的PV操作。

* 信号

使用信号值signo和信号处理器结构sigaction进行处理的。

关键函数：
sigaction, sigaddset, sigdelset

* 信号量

使用信号量结构 sem_t 来进行PV操作的。

* 消息队列 

进程间通过消息来进行通信。

关键字
msgget, msgsnd, msgrcv

* 共享内存

### 进程间通信、线程间通信

|类别    | 进程 | 线程 |
|--------|------|------|
|管道    | y    |      |
|信号    | y    |      |
|信号量  | y    | y    |
|共享内存| y    | y    |
|消息队列| y    |      |
|临界区  |      | y    |
|事件    |      | y    |
|套接字  | y    |      |

