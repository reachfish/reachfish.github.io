---
title: 网络编程学习
---

# UDP
进程的每个操作都正好产生一个UDP数据报，并组装成一份待发送的IP数据报。
这与面向字符流的协议不同，如TCP，应用程序产生的全体数据与真正发送的单个IP数据报可能没有什么联系。
UDP不保证数据报能到达目的地。

服务器可以用同一个UDP套接字给多个不同的客户接受数据报，每个客户一个数据报。
UDP也可以是全双工的。

# TCP 
TCP提供的是一种面向连接的、可靠的字节流服务。
应用数据被分割成TCP认为最适合发送的的数据块。这和UDP完全不同，应用程序产生的数据报长度将保持不变。
  
一个端口地址和一个端口称为一个插口socket。插口对socketpair(包含客户端IP和端口，服务端IP和端口)唯一确定一个TCP连接的双方。
  
TCP为应用层提供全双工服务。这意味数据能在两个方向上独立地进行传输。因此，连接的每一端必须保持每个方向上的传输数据序号。
TCP将用户数据打包构成报文段；它发送数据后启动一个定时器；另一端对收到的数据进行确认，对失序的数据重新排序，丢弃重复数据；TCP提供端到端的流量控制，并计算和验证一个强制性的端到端检验和。

### 建立连接时
告知对方：
1. MSS, 即每个TCP分节中愿意接收的最大数据量；
2. 广告窗口规模
3. 时间戳

## Nagle算法
基本定义：**任意时刻，最多只能有一个未被确认的小块**。
目的是尽可能发送大数据块，避免网络中充斥着许多小数据块。小段，是指小于MSS的数据块。
Nagle算法的规则，满足以下条件，则允许发送：
1. 包长度达到MSS
2. 该包包含有FIN
3. 设置TCP_NODELAY
4. 未设置TCP_CORK，但所有小数据包(长度小于MSS)均被确认；
5. 发生超时(一般为200ms)

可以通过设置TCP_NODELAY来禁止Nagle算法。注意此时虽然禁止Nagle算法，但网络的传输依然受到TCP确认延迟机制的影响。

Nagle算法和Cork算法的区别。
Nagle着眼于避免网络因小包而拥塞，而Cork着眼于提高网络的利用率。两者在避免发送小包的效果上是一致的。但是Nagle算法在小包都被确认之后会继续发小包，而Cork算法则会继续累积小包。

## 滑动窗口协议
该协议允许发送方在停止等待确认前可以连续发送多少个分组。由于发送方不必每发一个分组就停下来等待确认，因此该协议可以加速数据的发送。

+++发送并被确认+++  [ +++发送未被确认+++   +++可被发送+++ ]    +++不可以被发送+++ 
窗口左边沿向右移动，称为窗口合拢，发生在发送或确认数据时；
窗口右边沿向右移动，称为窗口张开，接收端读取确认数据并释放TCP缓存；
窗口右边沿向左移动，称为窗口收缩。

如果左边沿到达右边沿，则称其为一个零窗口，此时发送方不能发送任何数据。
